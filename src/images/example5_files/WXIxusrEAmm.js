;/*FB_PKG_DELIM*/

__d("MAWBumpThread",["ODS","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;async function s(t){var n=t.description,r=t.lastActivityTs,a=t.lastMessageCtaType,i=t.lastReadTs,l=t.threadKey,s=t.txn,u=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(s.threads).getKeyRange(l));if(u==null)return(e||(e=o("ODS"))).bumpEntityKey(3185,"armadillo_thread_bump","missing_thread");var c=babelHelpers.extends({},u,{lastActivityTimestampMs:r!=null?r:u.lastActivityTimestampMs,lastMessageCtaType:a,lastReadWatermarkTimestampMs:i!=null?i:u.lastReadWatermarkTimestampMs});await s.threads.put(c)}l.threadMutation_DEPRECATED=s}),98);
__d("MAWCreateOptimisticSecureMessage",["EntMessageReplyType","I64","LSAuthorityLevel","LSIntEnum","LSMessageReplySourceType","LSMessageReplySourceTypeV2","LSMessageSendStatus","LSQuickReplyType","LSReplyMessageAttachmentType","LSReplyMessageStatus","MAWBridgeBuildMsg","MAWMsgReplySnippet","MessagingAttachmentType","QPLUserFlow","ReQL","isMWBumpMessage","qpl","sendToSentQPLLogger"],(function(t,n,r,o,a,i,l){"use strict";var e,s;async function u(e,t,n,a){if(n==null)return[void 0,void 0];var i=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.messages).getKeyRange(t,n.timestampMs,n.messageId));r("QPLUserFlow").addPoint(r("qpl")._(25313175,"1551"),"get_reply_msg_end",{instanceKey:a});var l=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.attachments).getKeyRange(t,n.messageId));return r("QPLUserFlow").addPoint(r("qpl")._(25313175,"1551"),"get_reply_attachment_end",{instanceKey:a}),[i,l]}async function c(e,t){var n=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.tables.contacts).getKeyRange(t));return n==null?void 0:n.firstName}async function d(t,n,a,i){var l;if(n!=null){var s=r("isMWBumpMessage")(n.replyType)&&n.replyToUserId!=null?n.replyToUserId:n.senderId,u=await c(t,s),d=n.replyStatus!=null?(e||(e=o("I64"))).to_int32(n.replyStatus)===r("LSReplyMessageStatus").DELETED:!1;return(l=o("MAWMsgReplySnippet").buildLocalizedReplySnippetLegacy({isAuthorMe:!0,isBumpMsg:i,isDeletedMsg:d,recipientName:u,replySenderIsMe:(e||(e=o("I64"))).equal(s,a)}))==null?void 0:l.toString()}}function m(t){if(t!=null){var n=t.attachmentType;return(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))||(e||(e=o("I64"))).equal(n,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").STICKER))?t.previewUrl:void 0}}function p(t){if(t!=null)return(e||(e=o("I64"))).equal(t==null?void 0:t.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE))?(s||(s=o("LSIntEnum"))).ofNumber(r("LSReplyMessageAttachmentType").PHOTO):(e||(e=o("I64"))).equal(t==null?void 0:t.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").STICKER))?(s||(s=o("LSIntEnum"))).ofNumber(r("LSReplyMessageAttachmentType").STICKER):(e||(e=o("I64"))).equal(t==null?void 0:t.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO))?(s||(s=o("LSIntEnum"))).ofNumber(r("LSReplyMessageAttachmentType").VIDEO):(e||(e=o("I64"))).equal(t==null?void 0:t.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE))?(s||(s=o("LSIntEnum"))).ofNumber(r("LSReplyMessageAttachmentType").GIF):(e||(e=o("I64"))).equal(t==null?void 0:t.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").EPHEMERAL_IMAGE))||(e||(e=o("I64"))).equal(t==null?void 0:t.attachmentType,(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").EPHEMERAL_VIDEO))?(s||(s=o("LSIntEnum"))).ofNumber(r("LSReplyMessageAttachmentType").EPHEMERAL_RAVEN_MESSAGE):(s||(s=o("LSIntEnum"))).ofNumber(r("LSReplyMessageAttachmentType").OTHER)}async function _(e,t,n,a,i,l,c,_,f,g,h,y,C,b){var v=await o("sendToSentQPLLogger").measureSendToSentPerformance("optimistic_message_get_reply",_,function(){return u(t,l,a,_)}),S=v[0],R=v[1],L=o("MAWBridgeBuildMsg").buildOptimisticMessage(i,S,f,C),E=await o("sendToSentQPLLogger").measureSendToSentPerformance("optimistic_message_reply_snippet",_,function(){return d(e,S,n,b===!0)}),k=babelHelpers.extends({},L,{authorityLevel:(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").OPTIMISTIC),displayedContentTypes:s.ofNumber(y),hasQuickReplies:!1,hotEmojiSize:c,isAdminMessage:!1,isCollapsed:!1,isUnsent:!1,messageId:g,offlineThreadingId:g,primarySortKey:h,quickReplyType:s.ofNumber(r("LSQuickReplyType").NONE),replyAttachmentType:p(R),replyMediaPreviewHeight:R==null?void 0:R.previewHeight,replyMediaPreviewWidth:R==null?void 0:R.previewWidth,replyMediaUrl:m(R),replyMediaUrlMimeType:R==null?void 0:R.playableUrlMimeType,replySnippet:E,replySourceId:a==null?void 0:a.messageId,replySourceType:a!=null?(s||(s=o("LSIntEnum"))).ofNumber(r("LSMessageReplySourceType").MESSAGE):void 0,replySourceTypeV2:a!=null?(s||(s=o("LSIntEnum"))).ofNumber(r("LSMessageReplySourceTypeV2").MESSAGE):void 0,replyType:b===!0?(s||(s=o("LSIntEnum"))).ofNumber(r("EntMessageReplyType").BUMP):void 0,senderId:n,sendStatus:s.ofNumber(r("LSMessageSendStatus").SENDING_TO_SERVER),sendStatusV2:s.ofNumber(1),textHasLinks:!1,threadKey:l,timestampMs:h,transportKey:"WhatsApp",viewFlags:s.ofNumber(0)});return k}l.buildOptimisticLsMessage=_}),98);
__d("MAWFetchUserJids",["I64","MAWJids","ReQL"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n){var r=(e||(e=o("I64"))).of_string(n);return o("ReQL").toArrayAsync(o("ReQL").fromTableAscending(t.tables.participants).getKeyRange(r).filter(function(t){return!(e||(e=o("I64"))).equal(t.contactId,r)}).map(function(t){return o("MAWJids").toUserJid((e||(e=o("I64"))).to_string(t.contactId))}))}l.fetchUserJids=s}),98);
__d("MAWFetchXMABlob",["FBLogger","Promise"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t){var o=t.descriptionForLogging,a=t.url,i=t.xmaContentType;return a==null||a===""?(e||(e=n("Promise"))).resolve():window.fetch(a).then(function(e){return e.blob()}).catch(function(t){return r("FBLogger")("messenger_web_sharing").mustfix("Error fetching url in xma share from %s, with XMA content type %s and error %s",o,i,t),(e||(e=n("Promise"))).resolve()})}l.fetchBlob=s}),98);
__d("MAWFetchXMADataUtils",["FBLogger","LSXmaContentType","MAWFetchXMABlob","MAWGetImageSpec","MAWParseXMAFBConfig","WAArmadilloXMA.pb","sendToSentQPLLogger"],(function(t,n,r,o,a,i,l){"use strict";var e={failed_to_fetch_blob_for_xma_share:"Failed to fetch blob xma data for MAWShareAttachent",failed_to_fetch_json_for_xma_share:"Failed execute MAWShareAttachment_LinkPreviewQuery for MAWShareAttachent",failed_to_parse_json_for_xma_share:"Failed to fetch blob xma data for MAWShareAttachent"};function s(e){var t=Object.entries(r("LSXmaContentType")).find(function(t){var n=t[0],r=t[1];return e===r&&o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE[n]!=null}),n=t!=null?o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE[t[0]]:void 0;if(n!==void 0)return o("MAWParseXMAFBConfig").isFBSupportedTargetType({fbTargetType:n,silentExposure:!0})?n:(r("FBLogger")("messenger_web_sharing").mustfix("Unsupported XMA Target Type in sending path: "+n),o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE)}async function u(e,t){var n=e.favicon_blob,r=e.header_image_blob,a=e.overlayIconGlyph,i=e.preview_blob,l=i==null?void 0:new File([i],"preview",{type:i.type}),s=n==null?void 0:new File([n],"favicon",{type:n.type}),u=r==null?void 0:new File([r],"header",{type:r.type});o("sendToSentQPLLogger").markSendToSentPoint(t,"preview_favicon_spec_start");var c=a===o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE?Promise.resolve({height:2,width:2}):l!=null?o("MAWGetImageSpec").getImageSpec_DEPRECATED(l):Promise.resolve(),d=s!=null?o("MAWGetImageSpec").getImageSpec_DEPRECATED(s):Promise.resolve(),m=u!=null?o("MAWGetImageSpec").getImageSpec_DEPRECATED(u):Promise.resolve(),p=await Promise.all([c,d,m]),_=p[0],f=p[1],g=p[2];o("sendToSentQPLLogger").markSendToSentPoint(t,"preview_favicon_spec_ready");var h=l==null||_==null?void 0:{file:l,height:_.height,width:_.width},y=s==null||f==null?void 0:{file:s,height:f.height,width:f.width},C=u==null||g==null?void 0:{file:u,height:g.height,width:g.width};return{faviconFileArgs:y,headerImageFileArgs:C,previewFileArgs:h}}async function c(t,n,a,i,l,s){var u=await Promise.all([[(t==null?void 0:t.startsWith("ls"))===!0?null:t,"favicon"],[n,"image"],[a,"preview"],[i,"header_image"]].map(function(e){return o("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"MAWFetchXMAData_"+e[1],url:e[0],xmaContentType:s}).then(function(e){return e!=null?e:void 0})})).catch(function(t){return l.forEach(function(e){o("sendToSentQPLLogger").markSendToSentFail(e,"failed_to_fetch_blob_for_xma_share")}),r("FBLogger")("messenger_web_sharing").catching(t).mustfix(e.failed_to_fetch_blob_for_xma_share),[void 0,void 0,void 0,void 0]}),c=u[0],d=u[1],m=u[2],p=u[3];return[c,d,m,p]}l.XMA_DATA_ERRORS=e,l.convertXmaContentTypeToMessageType=s,l.makeXMAFileArgs=u,l.getPreviewBlobs=c}),98);
__d("MAWFetchXMAData_fetchXmaPreviewDataQuery_facebookRelayOperation",[],(function(t,n,r,o,a,i){a.exports="9840669832713841"}),null);
__d("MAWFetchXMAData_fetchXmaPreviewDataQuery.graphql",["MAWFetchXMAData_fetchXmaPreviewDataQuery_facebookRelayOperation"],(function(t,n,r,o,a,i){"use strict";var e=(function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"url"}],t=[{alias:null,args:[{fields:[{kind:"Variable",name:"url",variableName:"url"}],kind:"ObjectValue",name:"params"}],concreteType:"XFBXMAPreviewData",kind:"LinkedField",name:"xma_preview_data",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_receiver_fetch_supported",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_public",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"post_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"default_cta_title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"header_title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"subtitle_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"title_text",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"xma_content_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"favicon_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"header_image_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"preview_url",storageKey:null},{alias:null,args:null,concreteType:"XFBXMAPreviewDataCtaDataConnection",kind:"LinkedField",name:"cta_data",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBXMACtaData",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"cta_title",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cta_action_url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cta_native_url",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"MAWFetchXMAData_fetchXmaPreviewDataQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"MAWFetchXMAData_fetchXmaPreviewDataQuery",selections:t},params:{id:n("MAWFetchXMAData_fetchXmaPreviewDataQuery_facebookRelayOperation"),metadata:{},name:"MAWFetchXMAData_fetchXmaPreviewDataQuery",operationKind:"query",text:null}}})();a.exports=e}),null);
__d("MAWUnshimUrl",["CometLinkShimUtils"],(function(t,n,r,o,a,i,l){"use strict";function e(e){if(e!=null){var t=o("CometLinkShimUtils").getLinkShimInfo(e,void 0,void 0,void 0,void 0,void 0,!0);return t.shimmed?t.unshimmedHref:e}}l.unshimUrl=e}),98);
__d("MAWFetchXMAData",["fbt","CometRelay","ConstUriUtils","FBLogger","LSXmaContentType","MAWFetchXMADataUtils","MAWFetchXMAData_fetchXmaPreviewDataQuery.graphql","MAWUnshimUrl","MSGDataclassTypes.flow","WAArmadilloXMA.pb","getJSEnumSafe","isFacebookURI","isStringNullOrEmpty","justknobx","sendToSentQPLLogger"],(function(t,n,r,o,a,i,l,s){"use strict";var e;function u(e,t){var n;return t.forEach(function(e){o("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{xma_data_result:"private"}})}),{defaultCTA:{actionUrl:o("MAWUnshimUrl").unshimUrl(e),buttonType:(n=o("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:o("MAWUnshimUrl").unshimUrl(e),title:s._(/*BTDS*/"_j[\"Private post\",\"599d20d959e0009397c73fb9edb426dd\",1]").toString()},linkType:"internal",overlayIconGlyph:n.EXTENDED_CONTENT_MESSAGE_OVERLAY_ICON_GLYPH.PRIVATE,preview_blob:void 0,title_text:s._(/*BTDS*/"Facebook").toString(),transportLayerForLogging:"sender_copy",xma_message_type:n.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE,xmaTargetTypeForLogging:n.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE}}function c(t,r){return o("CometRelay").fetchQuery(t,e!==void 0?e:e=n("MAWFetchXMAData_fetchXmaPreviewDataQuery.graphql"),{url:r}).toPromise()}async function d(e,t,n){var a,i,l,s,d,m,p=await c(e,t).catch(function(e){n.forEach(function(t){o("sendToSentQPLLogger").markSendToSentFail(t,"failed_to_fetch_json_for_xma_share",e)}),r("FBLogger")("messenger_web_sharing").catching(e).mustfix(o("MAWFetchXMADataUtils").XMA_DATA_ERRORS.failed_to_fetch_json_for_xma_share)});n.forEach(function(e){o("sendToSentQPLLogger").markSendToSentPoint(e,"fetch_json_for_xma_share_end")});var _=p==null?void 0:p.xma_preview_data;if(_==null)return n.forEach(function(e){o("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{xma_data_result:"empty"}})}),u(t,n);if(_.is_public!==!0)return u(t,n);n.forEach(function(e){o("sendToSentQPLLogger").addSendToSentAnnotations(e,{string:{xma_data_result:"public"}})});var f={defaultCTA:{actionUrl:o("MAWUnshimUrl").unshimUrl(t),buttonType:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,nativeUrl:o("MAWUnshimUrl").unshimUrl(t),title:(a=_.default_cta_title)!=null?a:void 0},linkType:"internal",title_text:(i=(l=_.title_text)!=null?l:_.header_title)!=null?i:void 0},g=r("getJSEnumSafe")(r("LSXmaContentType"),_.xma_content_type),h=o("MAWFetchXMADataUtils").convertXmaContentTypeToMessageType(g),y=_.post_id,C=_.is_receiver_fetch_supported===!0;if(C&&y!=null){var b={__typename:"XMSGMsgrXmaContentRefDataclass",action_type:o("MSGDataclassTypes.flow").XmsgMsgrXmaActionType.Share,content_type:o("MSGDataclassTypes.flow").XmsgMsgrReceiverFetchContentType.Statusupdate,fetch_params:{__typename:"XMSGMsgrReceiverFetchXmaStatusUpdateFetchParams",post_id:y},xma_content_type:r("getJSEnumSafe")(r("LSXmaContentType"),_.xma_content_type),xma_layout_type:o("MSGDataclassTypes.flow").XmsgMsgrReceiverFetchXmaLayoutType.Single};return babelHelpers.extends({},f,{contentRef:JSON.stringify(b),transportLayerForLogging:"receiver_fetch",xma_message_type:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH,xmaTargetTypeForLogging:h})}var v=await o("MAWFetchXMADataUtils").getPreviewBlobs(_.favicon_url,null,_.preview_url,_.header_image_url,n,g),S=v[0],R=v[1],L=v[2],E=v[3];return babelHelpers.extends({},f,{ctas:(s=_.cta_data)==null||(s=s.nodes)==null?void 0:s.map(function(e){var t,n=o("MAWUnshimUrl").unshimUrl(r("isStringNullOrEmpty")(e.cta_action_url)?void 0:e.cta_action_url),a=o("MAWUnshimUrl").unshimUrl(r("isStringNullOrEmpty")(e.cta_native_url)?void 0:e.cta_native_url);return{actionUrl:n,buttonType:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_CTA_BUTTON_TYPE.OPEN_NATIVE,ctaType:"xma_web_url",nativeUrl:a,title:(t=e.cta_title)!=null?t:void 0}}),favicon_blob:S!=null?S:void 0,header_image_blob:E!=null?E:void 0,header_title:r("isStringNullOrEmpty")(_.title_text)?void 0:(d=_.header_title)!=null?d:void 0,preview_blob:L!=null?L:void 0,subtitle_text:(m=_.subtitle_text)!=null?m:void 0,transportLayerForLogging:"sender_copy",xma_message_type:h,xmaTargetTypeForLogging:h})}function m(e,t,n){var a,i=o("ConstUriUtils").getUri(t),l=i==null||(a=i.setSubDomain("www"))==null?void 0:a.toString();if(l==null)return Promise.resolve({linkType:"unknown",transportLayerForLogging:"sender_copy",xmaTargetTypeForLogging:null});var s=o("MAWUnshimUrl").unshimUrl(t);if(s!=null){var u=o("ConstUriUtils").getUri(s);if(u!=null&&!r("isFacebookURI")(u)&&r("justknobx")._("5006"))return Promise.resolve({linkType:"external",transportLayerForLogging:"sender_copy",xma_message_type:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE,xmaTargetTypeForLogging:o("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE})}return n.forEach(function(e){o("sendToSentQPLLogger").markSendToSentPoint(e,"fetch_json_for_xma_share_start")}),d(e,l,n)}l.fetchXMAData=m}),226);
__d("MAWThreadMappingUtils",["FBLogger","LSMessagingThreadTypeUtil","MAWJids","MAWMiActOnActThreadReadyInstrumentation","ReQL","ReQLSubscribe","err","setTimeout"],(function(t,n,r,o,a,i,l){"use strict";var e=3e4;async function s(e,t){var n=await o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.threads).getKeyRange(t));return n==null?(r("FBLogger")("messenger_web").mustfix("[onActThreadReady] Thread is not ready to be used."),null):o("LSMessagingThreadTypeUtil").isGroup(n.threadType)}function u(e,t){return Promise.all([s(e,t),o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.mi_act_mapping_table).getKeyRange(t))]).then(function(e){var t=e[0],n=e[1];return n==null||t==null?(r("FBLogger")("messenger_web").mustfix("[onActThreadReady] Thread is not ready to be used."),null):o("MAWJids").convertIntJidToChatJid(n.jid,t)})}function c(e,t){return o("ReQL").firstAsync(o("ReQL").fromTableAscending(e.mi_act_mapping_table).getKeyRange(t)).then(function(e){return e==null?(r("FBLogger")("messenger_web").mustfix("[onActThreadReady] Thread is not ready to be used."),null):e.jid})}async function d(t,n,a){var i,l=null,c=(i=o("MAWMiActOnActThreadReadyInstrumentation")).getOnActThreadReadyInstanceKey(a);i.startQPL(c,a,n,"getChatJidOnceInThreadMappingTable"),i.addPointQPL(c,"get_existing_int_jid_from_mapping_table_start");var d=await u(t.tables,n);if(i.addPointQPL(c,"get_existing_int_jid_from_mapping_table_end"),d!=null)return o("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(c),Promise.resolve(d);var m=await s(t.tables,n);if(m==null)throw o("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(c,"thread_not_ready_to_be_used"),r("FBLogger")("messenger_web").mustfixThrow("Thread is not ready to be used.");return o("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(c,"subscribe_to_mapping_table_start"),new Promise(function(a,i){var s=o("ReQL").fromTableDescending(t.tables.mi_act_mapping_table).getKeyRange(n),u=o("ReQLSubscribe").subscribeToFirst(s,function(e){e!=null&&(l!=null&&window.clearTimeout(l),u(),o("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(c,"subscribe_to_mapping_table_end"),o("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(c),a(o("MAWJids").convertIntJidToChatJid(e.jid,m)))});l=r("setTimeout")(function(){u(),o("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(c,"subscribe_to_mapping_table_timeout"),i(r("err")("Timeout waiting for int jid to be populated in mapping table."))},e)})}async function m(t,n,a){var i,l=null,s=(i=o("MAWMiActOnActThreadReadyInstrumentation")).getOnActThreadReadyInstanceKey(a);i.startQPL(s,a,n,"getIntJidOnceInThreadMappingTable"),i.addPointQPL(s,"get_existing_int_jid_from_mapping_table_start");var u=await c(t.tables,n);return i.addPointQPL(s,"get_existing_int_jid_from_mapping_table_end"),u!=null?(o("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(s),Promise.resolve(u)):(o("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(s,"subscribe_to_mapping_table_start"),new Promise(function(a,i){var u=o("ReQL").fromTableDescending(t.tables.mi_act_mapping_table).getKeyRange(n),c=o("ReQLSubscribe").subscribeToFirst(u,function(e){e!=null&&(l!=null&&window.clearTimeout(l),c(),o("MAWMiActOnActThreadReadyInstrumentation").addPointQPL(s,"subscribe_to_mapping_table_end"),o("MAWMiActOnActThreadReadyInstrumentation").endSuccessQPL(s),a(e.jid))});l=r("setTimeout")(function(){c(),o("MAWMiActOnActThreadReadyInstrumentation").endFailureQPL(s,"subscribe_to_mapping_table_timeout"),i(r("err")("Timeout waiting for int jid to be populated in mapping table."))},e)}))}l.isThreadGroup=s,l.getChatJidFromMappingTable=u,l.getIntJidFromMappingTable=c,l.getChatJidOnceInThreadMappingTable=d,l.getIntJidOnceInThreadMappingTable=m}),98);
__d("MAWGetProtocolMsgIdByMsgIdInUI",["I64","LSDatabaseSingleton","MAWBridgeSendAndReceive","MAWMpsGating","MAWThreadMappingUtils","MAWUserJidWrapper","WAJids","WAStanzaUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s,u=o("WAJids").createJidUtils({platform:"msgr"});async function c(t){var n=await(e||(e=o("LSDatabaseSingleton"))).getLSDatabaseSingletonPromiseOrValue();return n.runInTransaction(async function(e){var n=await e.messages.index("messageId").get(t);if(n==null)return null;var r=await o("MAWThreadMappingUtils").getChatJidFromMappingTable(e,n.threadKey);if(r!=null)return{author:u.toUserJid((s||(s=o("I64"))).to_float(n.senderId).toString()),chat:r,externalId:o("WAStanzaUtils").toStanzaId(n.offlineThreadingId)}},"readonly",void 0,void 0,i.id+":33")}var d=async function(t){if(o("MAWMpsGating").isFullMpsEnabled())return c(t);if(o("MAWMpsGating").isMpsMessageRendering()){var e=await c(t);return e!=null&&o("MAWUserJidWrapper").getMyUserJid()===e.author?{author:"@me",chat:e.chat,externalId:e.externalId}:e}return m(t)},m=function(t){return o("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:t})};l.getProtocolMsgIdByMsgIdUI=d}),98);
__d("MAWOptimisticMessageUtils",["I64","LSAuthorityLevel","LSHotEmojiSize","LSIntEnum","MAWAckLevel","MAWAdminMsg","MAWBumpThread","MAWLocalizationType","MAWMsgType","MessagingAttachmentType","ReQL","WAJids","WATimeUtils"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(){return o("WATimeUtils").millisTime()}async function c(t,n){var r=await o("ReQL").firstAsync(o("ReQL").fromTableDescending(t.threads.index("lastActivityTimestampMs")));return r==null||(e||(e=o("I64"))).equal(r.threadKey,n)?null:(e||(e=o("I64"))).add(r.lastActivityTimestampMs,e.one)}async function d(e,t){var n=t.threadKey,r=await c(e,n);await o("MAWBumpThread").threadMutation_DEPRECATED({description:"MAWOptimisticMessageUtils",lastActivityTs:r,lastReadTs:r,threadKey:n,txn:e})}async function m(e,t){var n=t.optimisticMediaAttachment,r=t.threadKey,a=g(n.type);if(a!=null){var i=await c(e,r);await o("MAWBumpThread").threadMutation_DEPRECATED({description:"MAWCreateOptimisticSecureMessageWithAttachment",lastActivityTs:i,lastReadTs:i,threadKey:r,txn:e})}}function p(e){var t=e.ephemeralSettings,n=e.externalId,r=e.threadJid,a=e.ts;return{ack:o("MAWAckLevel").ACK.partialOptimistic,altIndex:void 0,author:o("WAJids").AUTHOR_ME,ephemeralSetting:t!=null?t:void 0,externalId:n,isForwarded:!1,specialTextSize:void 0,threadJid:r,ts:o("WATimeUtils").castMilliSecondsToUnixTime(a)}}function _(e){var t=e.commands,n=e.content,r=e.initiatingSource,o=e.isFirstMsg,a=e.mentionedJids,i=e.optimisticMsg,l=e.quote,s=e.specialTextSize,u=e.threadSource;return{commands:t==null?void 0:t.slice(),content:n,initiatingSource:r,isFirstMsg:o,isForwarded:!1,mentionedJids:a==null?void 0:a.slice(),openMessageOtid:void 0,openMessageParticipantCount:void 0,optimisticMsg:i,participantCount:void 0,quote:l,source:u,specialTextSize:s}}function f(t){var n=t.optimisticMediaAttachment,a=t.threadKey,i=t.timestampMsI64,l={actionUrl:t.actionUrl,attachmentFbid:t.offlineAttachmentId,attachmentIndex:(e||(e=o("I64"))).zero,attachmentType:t.attachmentType,authorityLevel:(s||(s=o("LSIntEnum"))).ofNumber(r("LSAuthorityLevel").OPTIMISTIC),filename:n==null?void 0:n.filename,gifPlayback:t.gifPlayback,hasMedia:!e.equal(t.attachmentType,s.ofNumber(r("MessagingAttachmentType").XMA)),hasXma:e.equal(t.attachmentType,s.ofNumber(r("MessagingAttachmentType").XMA)),isHd:t.isHd,isSharable:!1,messageId:t.messageExternalId,offlineAttachmentId:t.offlineAttachmentId,receiverFetchId:t.contentRef,subtitleText:t.subtitleText,threadKey:a,timestampMs:i,titleText:t.titleText,transportKey:"WhatsApp",xmaContentType:t.xmaContentType};if(n){if(l=babelHelpers.extends({},l,{filesize:(e||(e=o("I64"))).of_float(n.file.size),previewUrl:n.url}),n.type==="image"||n.type==="animated_image"||n.type==="video"||n.type==="sticker"){var u,c,d,m;l=babelHelpers.extends({},l,{previewHeight:(u=n.thumbnailSpec)!=null&&u.height?(e||(e=o("I64"))).of_float((c=n.thumbnailSpec)==null?void 0:c.height):void 0,previewWidth:(d=n.thumbnailSpec)!=null&&d.width?(e||(e=o("I64"))).of_float((m=n.thumbnailSpec)==null?void 0:m.width):void 0})}n.type==="audio"&&(l=babelHelpers.extends({},l,{waveformData:n.waveformString}))}return l}function g(e){switch(e){case"animated_image":return o("MAWAdminMsg").buildLocalizedString([],[],o("MAWLocalizationType").CURRENT_USER_SEND_GIF);case"image":return o("MAWAdminMsg").buildLocalizedString([],[],o("MAWLocalizationType").CURRENT_USER_SEND_IMAGE);case"video":return o("MAWAdminMsg").buildLocalizedString([],[],o("MAWLocalizationType").CURRENT_USER_SEND_VIDEO);case"audio":return o("MAWAdminMsg").buildLocalizedString([],[],o("MAWLocalizationType").CURRENT_USER_SEND_AUDIO);case"document":return o("MAWAdminMsg").buildLocalizedString([],[],o("MAWLocalizationType").CURRENT_USER_SEND_ATTACHMENT);case"sticker":return o("MAWAdminMsg").buildLocalizedString([],[],o("MAWLocalizationType").CURRENT_USER_SEND_STICKER);default:return null}}function h(e){switch(e){case(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").STICKER):return o("MAWMsgType").MSG_TYPE.STICKER;case(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").IMAGE):return o("MAWMsgType").MSG_TYPE.IMAGE;case(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").ANIMATED_IMAGE):return o("MAWMsgType").MSG_TYPE.GIF;case(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").VIDEO):return o("MAWMsgType").MSG_TYPE.VIDEO;case(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").AUDIO):return o("MAWMsgType").MSG_TYPE.PTT;default:return o("MAWMsgType").MSG_TYPE.DOCUMENT_FILE}}function y(t){if(t!=null){if((e||(e=o("I64"))).equal(t,(s||(s=o("LSIntEnum"))).ofNumber(r("LSHotEmojiSize").SMALL)))return 1;if((e||(e=o("I64"))).equal(t,(s||(s=o("LSIntEnum"))).ofNumber(r("LSHotEmojiSize").MEDIUM)))return 2;if((e||(e=o("I64"))).equal(t,(s||(s=o("LSIntEnum"))).ofNumber(r("LSHotEmojiSize").LARGE)))return 3}}l.getOptimisticMessageTimestamp=u,l.getOptimisticThreadBumpTimestamp=c,l.optimisticBumpThread=d,l.optimisticBumpThreadMedia=m,l.buildMAWOptimisticBaseMsg=p,l.buildMAWBaseSendMsgArgs=_,l.buildOptimisticAttachment=f,l.lsAttachmentTypeToMsgType=h,l.getSpecialTextSize=y}),98);
__d("MessengerIntent",["WebStorage","justknobx"],(function(t,n,r,o,a,i,l){"use strict";var e,s="mw_sent_message";function u(){return r("justknobx")._("1630")}function c(){(e||(e=r("WebStorage"))).setItemGuarded(e.getLocalStorage(),s,String(Date.now()))}function d(){var t=(e||(e=r("WebStorage"))).getLocalStorage();return Date.now()-Number(t==null?void 0:t.getItem(s))<u()}l.sentMessage=c,l.hasSentMessagesRecently=d}),98);
__d("MWLSLogSend",["CometHeroLogging","I64","MWChatInteraction","MWSharedS2SBaseAnnotations","MessengerIntent"],(function(t,n,r,o,a,i,l){"use strict";var e;function s(t,n,a){var i=a.isCommunityEvent,l=a.isMessageRequest,s=a.source,u=a.threadType,c=r("CometHeroLogging").genHeroInteractionUUIDAndMarkStart(t.getTraceId());o("MWChatInteraction").set(n,c);var d={entrypoint:o("MWSharedS2SBaseAnnotations").getEntrypointAnnotation(s),is_community_event:i===!0?"true":"false",is_message_request:l===!0?"true":"false",thread_type:u==null?"unknown":(e||(e=o("I64"))).to_string(u)};return Object.entries(d).forEach(function(e){var n=e[0],r=e[1];t.addMetadata(n,String(r))}),o("MessengerIntent").sentMessage(),t.onComplete(function(){delete o("MWChatInteraction").interactions[n]})}l.logSentHeroInteraction=s}),98);
__d("useMAWCreateOptimisticSecureMessageWithXMAAttachment",["I64","LSIntEnum","MAWBumpThread","MAWCreateOptimisticSecureMessage","MAWOptimisticMessageUtils","MAWSendFileMsgTypes","MAWVault","MWPActor.react","MessagingAttachmentType","QPLUserFlow","qpl","react-compiler-runtime","useAsyncReStore"],(function(t,n,r,o,a,i,l){"use strict";var e,s;function u(){var e=o("react-compiler-runtime").c(3),t=r("useAsyncReStore")(),n=o("MWPActor.react").useActor(),a;return e[0]!==t||e[1]!==n?(a=function(o){var e=o.actionUrl,a=o.associatedMsgId,l=o.associatedMsgText,s=o.commands,u=o.contentRef,d=o.instanceKey,m=o.isReceiverFetch,p=o.lssTraceApi,_=o.mentionedJids,f=o.messageExternalId,g=o.messageText,h=o.offlineAttachmentId,y=o.onOfflineMsgId,C=o.optimisticMediaAttachment,b=o.reply,v=o.subtitleText,S=o.threadKey,R=o.titleText,L=o.xmaContentType,E=m===void 0?!1:m;return Promise.resolve(t).then(function(t){return r("QPLUserFlow").addPoint(r("qpl")._(25313175,"1551"),"before_create_optimistic_message_restore_resolved",{instanceKey:d}),t.runInTransaction(function(r){return c({actionUrl:e,associatedMsgId:a,associatedMsgText:l,commands:s,contentRef:u,db:t,instanceKey:d,isReceiverFetch:E,lssTraceApi:p,mentionedJids:_,messageExternalId:f,messageText:g,offlineAttachmentId:h,onOfflineMsgId:y,optimisticMediaAttachment:C,reply:b,senderId:n,subtitleText:v,threadKey:S,titleText:R,txn:r,xmaContentType:L})},"readwrite","ui",void 0,i.id+":93")})},e[0]=t,e[1]=n,e[2]=a):a=e[2],a}async function c(t){var n,a=t.actionUrl,i=t.associatedMsgId,l=t.associatedMsgText,u=t.commands,c=t.contentRef,d=t.db,m=t.instanceKey,p=t.isReceiverFetch,_=p===void 0?!1:p,f=t.lssTraceApi,g=t.mentionedJids,h=t.messageExternalId,y=t.messageText,C=t.offlineAttachmentId,b=t.onOfflineMsgId,v=t.optimisticMediaAttachment,S=t.reply,R=t.senderId,L=t.subtitleText,E=t.threadKey,k=t.titleText,I=t.txn,T=t.xmaContentType;b(h),f==null||f.addMarkerPoint("set_offline_message_external_id_for_ls_message","AppTiming");var D=o("MAWOptimisticMessageUtils").getOptimisticMessageTimestamp(),x=(e||(e=o("I64"))).of_float(D),$=_?536870912:1024,P=await o("MAWCreateOptimisticSecureMessage").buildOptimisticLsMessage(d,I,R,S,(n=o("MAWVault").unvault(y))!=null?n:"",E,void 0,m,g,h,x,$,u);await I.messages.add(P);var N=o("MAWOptimisticMessageUtils").buildOptimisticAttachment({actionUrl:a,attachmentType:(s||(s=o("LSIntEnum"))).ofNumber(r("MessagingAttachmentType").XMA),contentRef:c,messageExternalId:h,offlineAttachmentId:C,optimisticMediaAttachment:v,senderId:R,subtitleText:L,threadKey:E,timestampMsI64:x,titleText:k,xmaContentType:T});if(await I.attachments.add(N),i!=null&&l!=null&&l!==""){var M,w=await o("MAWCreateOptimisticSecureMessage").buildOptimisticLsMessage(d,I,R,S,(M=o("MAWVault").unvault(l))!=null?M:"",E,void 0,m,g,i,x,1,u);await I.messages.add(w)}return r("QPLUserFlow").addPoint(r("qpl")._(25313175,"1551"),"after_create_optimistic_message",{instanceKey:m}),r("QPLUserFlow").addPoint(r("qpl")._(25313175,"1551"),"optimistic_bump_thread_start",{instanceKey:m}),await o("MAWBumpThread").threadMutation_DEPRECATED({description:"useMAWCreateOptimisticSecureMessageWithXMAAttachment",lastActivityTs:x,lastReadTs:x,threadKey:E,txn:I}),r("QPLUserFlow").addPoint(r("qpl")._(25313175,"1551"),"optimistic_bump_thread_end",{instanceKey:m}),{messageExternalId:h,offlineAttachmentId:o("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(C),offlineMsgTimestamp:D}}l.useMAWCreateOptimisticSecureMessageWithXMAAttachment=u}),98);