---
// Video Splash Screen Component
// Plays a video on first load and fades out to reveal the main content
---

<!-- Inline script runs immediately to prevent flash -->
<script is:inline>
  (function() {
    if (sessionStorage.getItem("hasSeenIntroVideo")) {
      // Add style immediately to hide splash before it renders
      document.documentElement.style.setProperty('--splash-display', 'none');
    }
  })();
</script>

<div id="video-splash" class="video-splash">
  <video
    id="splash-video"
    autoplay
    muted
    playsinline
    class="splash-video"
  >
    <source src="/hp-intro.mp4" type="video/mp4" />
  </video>
  <button id="skip-video" class="skip-button" aria-label="Skip intro">
    Skip Intro
  </button>
</div>

<style>
  .video-splash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 9999;
    background-color: #0a0a0a;
    display: var(--splash-display, flex);
    align-items: center;
    justify-content: center;
    transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
  }

  .video-splash.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }

  .splash-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .skip-button {
    position: absolute;
    bottom: 2rem;
    right: 2rem;
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 9999px;
    color: white;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0;
    animation: fadeIn 0.5s ease-out 1s forwards;
  }

  .skip-button:hover {
    background: rgba(255, 255, 255, 0.25);
    transform: scale(1.05);
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  /* Hide on reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    .video-splash {
      display: none;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const splash = document.getElementById("video-splash");
    const video = document.getElementById("splash-video") as HTMLVideoElement;
    const skipButton = document.getElementById("skip-video");
    
    // Check if user has already seen the video this session
    const hasSeenVideo = sessionStorage.getItem("hasSeenIntroVideo");
    
    if (hasSeenVideo) {
      // Already handled by inline script, but ensure it's hidden
      return;
    }

    const hideSplash = () => {
      if (splash) {
        splash.classList.add("hidden");
        // Remove from DOM after transition
        setTimeout(() => {
          splash.style.display = "none";
        }, 800);
        // Mark as seen for this session
        sessionStorage.setItem("hasSeenIntroVideo", "true");
      }
    };

    // Hide when video ends
    if (video) {
      video.addEventListener("ended", hideSplash);
      
      // Fallback: hide after 10 seconds max in case video is long
      setTimeout(hideSplash, 10000);
    }

    // Skip button
    if (skipButton) {
      skipButton.addEventListener("click", hideSplash);
    }

    // Allow clicking anywhere to skip
    if (splash) {
      splash.addEventListener("click", (e) => {
        if (e.target === splash || e.target === video) {
          hideSplash();
        }
      });
    }

    // Keyboard escape to skip
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        hideSplash();
      }
    });
  });
</script>

