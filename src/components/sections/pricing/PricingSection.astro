---
// Import SecondaryCTA component for use in this module
import Icon from "@components/ui/icons/Icon.astro";
import { Image } from "astro:assets";

// Import benefit images
import hvacLifespan from "@images/hvac-lifespan.png";
import utilityBill from "@images/utility-bill.jpg";
import repair from "@images/repair.webp";
import airQuality from "@images/air-quality.jpg";

// Create image mapping
const imageMap: Record<string, any> = {
  "src/images/hvac-lifespan.png": hvacLifespan,
  "src/images/utility-bill.jpg": utilityBill,
  "src/images/repair.webp": repair,
  "src/images/air-quality.jpg": airQuality,
};

// Define props from Astro
const { pricing } = Astro.props;

// Define TypeScript type for products.
type Product = {
  name: string;
  description: string;
  price: string;
  cents: string;
  billingFrequency: string;
  features: Array<string>;
  purchaseBtnTitle: string;
  purchaseLink: string;
};
---

<section
  class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
>
  <!-- Section heading -->
  <div class="mx-auto mb-10 max-w-2xl text-center lg:mb-14">
    <h2
      class="text-balance text-2xl font-bold tracking-tight text-neutral-800 dark:text-neutral-200 md:text-4xl md:leading-tight"
    >
      {pricing.title}
    </h2>
    <h3 class="mt-4 text-lg font-semibold text-neutral-700 dark:text-neutral-300">
      Why Choose a Kelch's Total Comfort Care Plan?
    </h3>
  </div>

  <!-- Benefits Cards Grid -->
  <div class="mb-12 grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
    {
      pricing.subTitle.map((item: any) => {
        // Handle both old string format and new object format
        let title: string;
        let description: string;
        let imagePath: string | null = null;
        
        if (typeof item === 'string') {
          // Old format: HTML string
          const match = item.match(/<b>(.*?)<\/b>\s*-\s*(.*)/);
          title = match ? match[1] : item;
          description = match ? match[2] : "";
        } else {
          // New format: object with title, description, image
          title = item.title || "";
          description = item.description || "";
          imagePath = item.image || null;
        }
        
        return (
          <div
            class="group overflow-hidden rounded-xl bg-white shadow-lg transition-all duration-300 hover:shadow-xl dark:bg-neutral-800"
          >
            <!-- Image at top -->
            <div class="relative h-48 w-full overflow-hidden rounded-t-xl">
              {imagePath && imageMap[imagePath] ? (
                <Image
                  src={imageMap[imagePath]}
                  alt={title}
                  class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
                  draggable={"false"}
                  format={"avif"}
                  loading={"lazy"}
                />
              ) : (
                <div class="h-full w-full bg-gradient-to-br from-red-500/20 to-orange-500/20 dark:from-red-500/10 dark:to-orange-500/10 flex items-center justify-center">
                  <div class="text-6xl opacity-30">ðŸ“·</div>
                </div>
              )}
            </div>

            <!-- Content below image -->
            <div class="p-6">
              <h3 class="mb-2 text-lg font-bold text-red-500 dark:text-orange-400">
                {title}
              </h3>
              <p class="text-sm text-neutral-700 dark:text-neutral-300">
                {description}
              </p>
            </div>
          </div>
        );
      })
    }
  </div>

  <!-- CTA Link -->
  <div class="mx-auto mb-10 max-w-2xl text-center lg:mb-14">
    <a
      href=""
      class="text-balance text-2xl font-bold tracking-tight text-neutral-800 dark:text-neutral-200 md:text-4xl md:leading-tight outline-none transition duration-100 hover:text-neutral-600 dark:hover:text-neutral-300 focus-visible:ring"
    >
      View All Maintenance Plans 
    </a>
  </div>
  <!-- Contains three main product blocks -->
  <div class="flex flex-wrap items-stretch justify-center gap-4 sm:gap-0">
    <!-- Starter Kit product details -->
    <div
      class="flex w-full flex-col rounded-xl bg-gray-800 p-6 sm:w-1/3 sm:mt-12 sm:p-8"
    >
      <div class="mb-8">
        <h3 class="text-2xl font-bold text-neutral-100 sm:text-3xl">
          {pricing.starterKit.name}
        </h3>
        <p class="mt-3 text-indigo-300">{pricing.starterKit.description}</p>
      </div>
      <!-- Features list - automatically created by mapping over `features` array -->
      <ul class="mb-6 space-y-2 text-neutral-300">
        {
          pricing.starterKit.features.map((feature: string) => (
            <li class="flex items-start gap-2 text-base">
              <span class="mt-0.5 flex-shrink-0">
                <Icon name="checkCircle" />
              </span>
              <span class="flex-1">{feature}</span>
            </li>
          ))
        }
      </ul>
      <!-- CTA for purchasing the product -->
      <div class="mt-auto">
        <a
          href={pricing.starterKit.purchaseLink}
          class="block rounded-lg bg-gray-500 px-8 py-3 text-center text-sm font-bold text-gray-100 outline-none ring-indigo-300 transition duration-100 hover:bg-gray-600 focus-visible:ring active:text-gray-300 md:text-base mb-2"
          >
          {pricing.starterKit.purchaseBtnTitle}
          </a
        >

        <a
          href={pricing.starterKit.purchaseLinkYearly}
          class="block rounded-lg bg-gray-500 px-8 py-3 text-center text-sm font-bold text-gray-100 outline-none ring-indigo-300 transition duration-100 hover:bg-gray-600 focus-visible:ring active:text-gray-300 md:text-base"
          >
        <div>
          {pricing.starterKit.purchaseBtnTitleYearly}
        </div>
        <div class="text-xs italic">
          {pricing.starterKit.purchaseBtnSavingsYearly}
        </div>
        </a
      >
      </div>
    </div>
    <!-- Professional Toolbox product details -->
    <div
      class="flex w-full flex-col rounded-xl bg-gradient-to-tr from-red-500 to-red-900 p-6 shadow-xl sm:w-1/3 sm:p-8"
    >
      <div
        class="mb-8 flex flex-col items-start justify-between gap-4 lg:flex-row"
      >
        <div>
          <h3 class="text-2xl font-bold text-neutral-100 sm:text-3xl">
            {pricing.professionalToolbox.name}
          </h3>
          <p class="mt-3 text-orange-200">{pricing.professionalToolbox.description}</p>
        </div>

        <span
          class="order-first inline-block rounded-full bg-orange-200 bg-opacity-50 px-3 py-1 text-xs font-bold uppercase tracking-wider text-center text-blue-900 lg:order-none"
          >{pricing.badge}</span
        >
      </div>
      <!-- Features list - automatically created by mapping over `features` array -->
      <ul class="mb-6 space-y-2 text-orange-100">
        {
          pricing.professionalToolbox.features.map((feature: string) => (
            <li class="flex items-start gap-2 text-base">
              <span class="mt-0.5 flex-shrink-0">
                <Icon name="checkCircle" />
              </span>
              <span class="flex-1">{feature}</span>
            </li>
          ))
        }
      </ul>
      <!-- CTA for purchasing the product -->
      <div class="mt-auto">
        <a
          href={pricing.professionalToolbox.purchaseLink}
          class="block rounded-lg bg-orange-200 bg-opacity-50 px-8 py-3 text-center text-sm font-bold text-neutral-100 outline-none ring-orange-300 transition duration-100 hover:bg-orange-300 hover:bg-opacity-50 focus-visible:ring active:bg-orange-400 md:text-base mb-2"
          >{pricing.professionalToolbox.purchaseBtnTitle}</a
        >

        <a
          href={pricing.professionalToolbox.purchaseLinkYearly}
          class="block rounded-lg bg-orange-200 bg-opacity-50 px-8 py-3 text-center text-sm font-bold text-neutral-100 outline-none ring-orange-300 transition duration-100 hover:bg-orange-300 hover:bg-opacity-50 focus-visible:ring active:bg-orange-400 md:text-base"
          >
          <div>
            {pricing.professionalToolbox.purchaseBtnTitleYearly}
          </div>
          <div class="text-xs italic">
            {pricing.professionalToolbox.purchaseBtnSavingsYearly}
          </div>
          </a
        >
      </div>
    </div>
    <!-- Enterprise Suite product details -->
    <div
      class="flex w-full flex-col rounded-xl bg-white p-6 shadow-xl sm:w-1/3 sm:mt-12 sm:p-8"
    >
      <div
        class="mb-8 flex flex-col items-start justify-between gap-4 lg:flex-row"
      >
        <div>
          <h3 class="text-2xl font-bold text-red-500 sm:text-3xl">
            {pricing.enterpriseSuite.name}
          </h3>
          <p class="mt-3 text-blue-200">{pricing.enterpriseSuite.description}</p>
        </div>
      </div>

      <ul class="mb-6 space-y-2 text-blue-100">
        {
          pricing.enterpriseSuite.features.map((feature: string) => (
            <li class="flex items-start gap-2 text-base">
              <span class="mt-0.5 flex-shrink-0">
                <Icon name="checkCircle" />
              </span>
              <span class="flex-1">{feature}</span>
            </li>
          ))
        }
      </ul>

      <div class="mt-auto">
        <a
          href={pricing.enterpriseSuite.purchaseLink}
          class="block rounded-lg bg-blue-200 bg-red-500 px-8 py-3 text-center text-sm font-bold text-neutral-100 outline-none ring-blue-300 transition duration-100 hover:bg-blue-300 hover:bg-opacity-50 focus-visible:ring active:bg-blue-400 md:text-base mb-2"
          >{pricing.enterpriseSuite.purchaseBtnTitle}</a
        >

        <a
          href={pricing.enterpriseSuite.purchaseLinkYearly}
          class="block rounded-lg bg-blue-200 bg-red-500 px-8 py-3 text-center text-sm font-bold text-neutral-100 outline-none ring-blue-300 transition duration-100 hover:bg-blue-300 hover:bg-opacity-50 focus-visible:ring active:bg-blue-400 md:text-base"
          >
          <div>
            {pricing.enterpriseSuite.purchaseBtnTitleYearly}
          </div>
          <div class="text-xs italic">
            {pricing.enterpriseSuite.purchaseBtnSavingsYearly}
          </div>
          </a
        >
      </div>
    </div>
  </div>
</section>

